<div class="forgot-password-page">
  <div class="forgot-container">
    <div class="forgot-card">
      <!-- Header -->
      <div class="header">
        <button class="back-btn" (click)="goToLogin()" *ngIf="!showOptions">
          <i class="fas fa-arrow-left"></i>
        </button>
        <button class="back-btn" (click)="goBack()" *ngIf="showOptions">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="icon-wrapper">
          <i class="fas fa-key"></i>
        </div>
        <h2>Forgot Password?</h2>
        <p class="subtitle">Don't worry, we'll help you recover your account</p>
      </div>

      <!-- Success Message -->
      <div class="alert alert-success" *ngIf="success">
        <i class="fas fa-check-circle"></i> {{ success }}
      </div>

      <!-- Error Message -->
      <div class="alert alert-error" *ngIf="error">
        <i class="fas fa-exclamation-circle"></i> {{ error }}
      </div>

      <!-- Step 1: Email Input -->
      <div class="email-section" *ngIf="!showOptions && !success">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="email"
            placeholder="Enter your email"
            (keyup.enter)="checkEmail()"
            [disabled]="checking2FA"
          />
        </div>

        <button 
          class="btn-primary" 
          (click)="checkEmail()"
          [disabled]="checking2FA || !email.trim()"
        >
          <span *ngIf="!checking2FA">Continue</span>
          <span *ngIf="checking2FA">
            <i class="fas fa-spinner fa-spin"></i> Checking...
          </span>
        </button>
      </div>

      <!-- Step 2: Recovery Options -->
      <div class="options-section" *ngIf="showOptions && !selectedMethod && !success">
        <h3>Choose Recovery Method</h3>
        <p class="info-text">Select how you'd like to recover your account:</p>

        <div class="recovery-options">
          <!-- Option 1: Use 2FA/Backup Code -->
          <div class="option-card" (click)="selectMethod('login-2fa')">
            <div class="option-icon">
              <i class="fas fa-mobile-alt"></i>
            </div>
            <div class="option-content">
              <h4>Use 2FA or Backup Code</h4>
              <p>Login with your authenticator app code or backup code</p>
            </div>
            <i class="fas fa-chevron-right arrow"></i>
          </div>

          <!-- Option 2: Email Reset Link -->
          <div class="option-card" (click)="selectMethod('reset-link')">
            <div class="option-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="option-content">
              <h4>Email Reset Link</h4>
              <p>Receive a password reset link in your email</p>
            </div>
            <i class="fas fa-chevron-right arrow"></i>
          </div>
        </div>
      </div>

      <!-- Step 3a: Login with 2FA -->
      <div class="method-section" *ngIf="selectedMethod === 'login-2fa' && !success">
        <div class="method-header">
          <i class="fas fa-mobile-alt"></i>
          <h3>Enter 2FA or Backup Code</h3>
          <p>Use your authenticator app code or one of your saved backup codes</p>
        </div>

        <div class="form-group">
          <label for="twoFactorCode">6-Digit Code or Backup Code</label>
          <input
            type="text"
            id="twoFactorCode"
            [(ngModel)]="twoFactorCode"
            placeholder="000000 or XXXX-XXXX"
            (keyup.enter)="loginWith2FA()"
            class="code-input"
            [disabled]="loading"
          />
          <small class="hint">Backup codes are in format: ABCD-1234</small>
        </div>

        <button 
          class="btn-primary" 
          (click)="loginWith2FA()"
          [disabled]="loading || !twoFactorCode.trim()"
        >
          <span *ngIf="!loading">Login with Code</span>
          <span *ngIf="loading">
            <i class="fas fa-spinner fa-spin"></i> Verifying...
          </span>
        </button>

        <div class="divider">or</div>

        <button class="btn-secondary" (click)="selectMethod('reset-link')">
          Use Email Reset Link Instead
        </button>
      </div>

      <!-- Step 3b: Send Reset Link -->
      <div class="method-section" *ngIf="selectedMethod === 'reset-link' && !success">
        <div class="method-header">
          <i class="fas fa-envelope"></i>
          <h3>Email Reset Link</h3>
          <p>We'll send a secure link to <strong>{{ email }}</strong></p>
        </div>

        <div class="info-box">
          <i class="fas fa-info-circle"></i>
          <div>
            <h4>What happens next?</h4>
            <ul>
              <li>You'll receive an email with a reset link</li>
              <li>Click the link to create a new password</li>
              <li>The link expires in 1 hour for security</li>
            </ul>
          </div>
        </div>

        <button 
          class="btn-primary" 
          (click)="sendResetLink()"
          [disabled]="loading"
        >
          <span *ngIf="!loading">
            <i class="fas fa-paper-plane"></i> Send Reset Link
          </span>
          <span *ngIf="loading">
            <i class="fas fa-spinner fa-spin"></i> Sending...
          </span>
        </button>

        <div class="divider">or</div>

        <button class="btn-secondary" (click)="selectMethod('login-2fa')">
          Use 2FA Code Instead
        </button>
      </div>

      <!-- Success State -->
      <div class="success-section" *ngIf="success && selectedMethod === 'reset-link'">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3>Check Your Email</h3>
        <p>We've sent a password reset link to <strong>{{ email }}</strong></p>
        <button class="btn-primary" (click)="goToLogin()">
          Back to Login
        </button>
      </div>

      <!-- Footer -->
      <div class="footer" *ngIf="!success">
        <p>Remember your password? <a (click)="goToLogin()" class="link">Back to Login</a></p>
      </div>
    </div>
  </div>
</div>
