<div class="users-panel">
  <div class="header">
    <h2 class="title">User Management</h2>
    <div class="actions">
      <input type="text" [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="Search users..." class="search-input" />
      <button (click)="loadUsers()" class="btn-refresh" [disabled]="loading">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-value">{{ users.length }}</div>
      <div class="stat-label">Total Users</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ filteredUsers.length }}</div>
      <div class="stat-label">Filtered</div>
    </div>
  </div>

  <div class="table-wrapper" *ngIf="!loading && paginatedUsers.length > 0">
    <table class="users-table">
      <thead>
        <tr>
          <th>User</th>
          <th>Email</th>
          <th>Status</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers">
          <td>
            <div class="user-cell">
              <div class="avatar">{{ ((user.userProfile.firstName || '').charAt(0) || 'U') + ((user.userProfile.lastName || '').charAt(0) || 'N') }}</div>
              <div>
                <div class="user-name">{{ user.userProfile.firstName || '' }} {{ user.userProfile.lastName || '' }}</div>
                <div class="user-id">ID: {{ user.appUser.userId }}</div>
              </div>
            </div>
          </td>
          <td>{{ user.appUser.email }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'badge-active': isActive(user.appUser.status || ''),
              'badge-banned': isBanned(user.appUser.status || ''),
              'badge-pending': isPendingVerification(user.appUser.status || '')
            }">{{ user.appUser.status }}</span>
          </td>
          <td>{{ user.appUser.role }}</td>
          <td>
            <div class="action-btns">
              <button (click)="viewUserProfile(user.appUser!.userId)" class="btn-sm btn-view" title="View Profile">
                <i class="fas fa-eye"></i>
              </button>
              <button *ngIf="!isBanned(user.appUser.status || '')" (click)="banUser(user.appUser!.userId)" class="btn-sm btn-ban" title="Ban User">
                <i class="fas fa-ban"></i>
              </button>
              <button *ngIf="isBanned(user.appUser.status || '')" (click)="unbanUser(user.appUser!.userId)" class="btn-sm btn-unban" title="Unban User">
                <i class="fas fa-check"></i>
              </button>
              <button *ngIf="isPendingVerification(user.appUser.status || '')" (click)="verifyUser(user.appUser!.userId)" class="btn-sm btn-verify" title="Verify User">
                <i class="fas fa-user-check"></i>
              </button>
              <button (click)="resetPassword(user.appUser!.email)" class="btn-sm btn-reset" title="Reset Password">
                <i class="fas fa-key"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination" *ngIf="totalPages > 1">
    <button (click)="prevPage()" [disabled]="currentPage === 1" class="page-btn">
      <i class="fas fa-chevron-left"></i>
    </button>
    <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="page-btn">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <div class="loading-state" *ngIf="loading">
    <i class="fas fa-spinner fa-spin"></i> Loading users...
  </div>

  <div class="empty-state" *ngIf="!loading && paginatedUsers.length === 0">
    <i class="fas fa-users"></i>
    <p>No users found.</p>
  </div>
</div>

<!-- Modals -->
<app-confirmation-modal
  *ngIf="showModal"
  [isVisible]="showModal"
  [data]="modalData"
  (confirmed)="onModalConfirmed($event)"
  (cancelled)="onModalCancelled()"
></app-confirmation-modal>

<app-success-modal
  *ngIf="showSuccessModal"
  [isVisible]="showSuccessModal"
  [data]="successModalData"
  (closed)="onSuccessModalClosed()"
></app-success-modal>
